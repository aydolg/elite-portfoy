<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Elite Portf√∂y Terminali</title>

<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
<link rel="manifest" href="manifest.json">
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
 --bg:#030508;--card-bg:rgba(16,20,29,.85);
 --accent:#00ff9d;--red:#ff3b5c;
 --text:#fff;--muted:#94a3b8;--border:rgba(255,255,255,.1)
}
body{margin:0;padding:12px;background:var(--bg);color:var(--text);font-family:'Plus Jakarta Sans',sans-serif}
.container{max-width:1200px;margin:auto}

#alertBar{
 display:none;position:sticky;top:0;z-index:999;
 background:#7f1d1d;padding:10px;border-radius:12px;
 font-size:.7rem;font-weight:800;text-align:center;margin-bottom:10px
}

.up{color:var(--accent)} .down{color:var(--red)}
</style>
</head>

<body>

<div id="alertBar"></div>

<div class="container">

  <canvas id="pieChart" height="180"></canvas>

</div>

<script>
const csvUrl="https://docs.google.com/spreadsheets/d/e/2PACX-1vQeTFovlKfvEp9sPepJb9SGxf_2AgMU7eEPTDCc6WWc0o1Z1AizX6K2mJlaWtcvSderiBym7cyhEdsC/pub?gid=0&single=true&output=csv";
let globalData=[];

function clean(v){
 if(!v||v.toString().includes('#'))return 0;
 return parseFloat(v.toString().replace(/\./g,'').replace(',','.'))||0;
}

Papa.parse(csvUrl,{
 download:true,
 complete:r=>{
  globalData=r.data.slice(1).filter(a=>a[0]).map(a=>({
   ad:a[0],tur:a[1],
   yatirim:clean(a[6]),tutar:clean(a[8]),
   gKZ:clean(a[9]),tKZ:clean(a[12])
  }));
  riskKontrol();
  drawCharts();
 }
});

function riskKontrol(){
 const bar=document.getElementById("alertBar");
 const toplam=globalData.reduce((s,a)=>s+a.tutar,0);
 const gunluk=globalData.reduce((s,a)=>s+a.gKZ,0);

 let risk=globalData.find(a=>a.tutar/toplam>0.4);
 if(risk){
  bar.innerText=`‚ö†Ô∏è Rƒ∞SK: ${risk.ad} portf√∂y√ºn %${Math.round(risk.tutar/toplam*100)}‚Äôi`;
  bar.style.display="block";return;
 }
 if(gunluk/toplam<-0.01){
  bar.innerText=`üö® ALARM: G√ºnl√ºk kayƒ±p %${(gunluk/toplam*100).toFixed(2)}`;
  bar.style.display="block";return;
 }
 bar.style.display="none";
}

function drawCharts(){
 let byType={};
 globalData.forEach(a=>byType[a.tur]=(byType[a.tur]||0)+a.tutar);
 new Chart(document.getElementById("pieChart"),{
  type:'doughnut',
  data:{labels:Object.keys(byType),datasets:[{data:Object.values(byType)}]},
  options:{plugins:{legend:{labels:{color:'#fff'}}}}
 });
}

if('serviceWorker'in navigator){
 navigator.serviceWorker.register('service-worker.js');
}
</script>

</body>
</html>
